{% extends "base.html" %}
{% block title %}Dashboard - CRM{% endblock %}

{% block content %}
<h2 style="margin-bottom: 2rem; color: #2c3e50;">üìä Dashboard</h2>

<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-number">{{ orders_today }}</div>
        <div class="stat-label">–ó–∞–∫–∞–∑–æ–≤ —Å–µ–≥–æ–¥–Ω—è</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-number">{{ "%.0f"|format(revenue_today) }} ‚Ç∏</div>
        <div class="stat-label">–í—ã—Ä—É—á–∫–∞ —Å–µ–≥–æ–¥–Ω—è</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-number">{{ status_counts.get('N', 0) + status_counts.get('new', 0) }}</div>
        <div class="stat-label">–ù–æ–≤—ã—Ö –∑–∞–∫–∞–∑–æ–≤</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-number">{{ status_counts.get('TR', 0) + status_counts.get('CO', 0) }}</div>
        <div class="stat-label">–í —Ä–∞–±–æ—Ç–µ</div>
    </div>
</div>


<div class="card">
    <div class="card-header">
        <h3>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–∫–∞–∑—ã</h3>
    </div>
    <div style="overflow-x: auto;">
        <table>
            <thead>
                <tr>
                    <th>–ù–æ–º–µ—Ä</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–ö–ª–∏–µ–Ω—Ç</th>
                    <th>–°—É–º–º–∞</th>
                    <th>–î–∞—Ç–∞</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                {% for order in recent_orders %}
                <tr>
                    <td><strong>{{ order.order_number }}</strong></td>
                    <td>
                        <span class="status status-{{ order.status }}">
                            {{ order.status }}
                        </span>
                    </td>
                    <td>{{ order.recipient_name }}</td>
                    <td><strong>{{ "%.0f"|format(order.total_amount) }} ‚Ç∏</strong></td>
                    <td>{{ order.created_at[:16] }}</td>
                    <td>
                        <a href="/crm/orders/{{ order.id }}" class="btn btn-primary">
                            –û—Ç–∫—Ä—ã—Ç—å
                        </a>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="6" style="text-align: center; padding: 2rem; color: #6c757d;">
                        –ó–∞–∫–∞–∑–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div class="card" style="margin-top: 2rem;">
    <div class="card-header">
        <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º</h3>
    </div>
    <div class="card-body">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
            {% for status, count in status_counts.items() %}
            <div style="text-align: center;">
                <div style="font-size: 1.5rem; font-weight: bold; color: #2c3e50;">{{ count }}</div>
                <div style="color: #6c757d; margin-top: 0.5rem;">
                    <span class="status status-{{ status }}">{{ status }}</span>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

{% endblock %}