{% extends "base.html" %}
{% block title %}{{ product.name }} - CRM{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
    <h2 style="color: #2c3e50;">
        üå∏ {{ product.name }}
    </h2>
    <a href="/crm/products" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a>
</div>

<div style="display: grid; grid-template-columns: 1fr 2fr; gap: 2rem; margin-bottom: 2rem;">
    
    <!-- Product Image -->
    <div class="card">
        <div class="card-header">
            <h3>üì∑ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</h3>
        </div>
        <div class="card-body" style="text-align: center;">
            {% set image_url = product.get('metadata', {}).get('properties', {}).get('ru_img_miniature') %}
            {% if image_url %}
            <img src="https://cvety.kz{{ image_url }}" 
                 alt="{{ product.name }}" 
                 style="max-width: 100%; max-height: 400px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
            {% else %}
            <div style="width: 100%; height: 300px; background: #f8f9fa; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #6c757d; font-size: 3rem;">
                üå∏
            </div>
            <p style="color: #6c757d; margin-top: 1rem;">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ</p>
            {% endif %}
        </div>
    </div>
    
    <!-- Product Information -->
    <div class="card">
        <div class="card-header">
            <h3>üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–µ</h3>
        </div>
        <div class="card-body">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                <div>
                    <strong>–¶–µ–Ω–∞:</strong><br>
                    {% if product.old_price and product.old_price > product.price %}
                    <span style="text-decoration: line-through; color: #6c757d; font-size: 0.9rem;">
                        {{ "%.0f"|format(product.old_price) }} ‚Ç∏
                    </span><br>
                    {% endif %}
                    <span style="font-size: 1.5rem; font-weight: bold; color: #27ae60;">
                        {{ "%.0f"|format(product.price) }} ‚Ç∏
                    </span>
                </div>
                <div>
                    <strong>–°—Ç–∞—Ç—É—Å:</strong><br>
                    {% if product.is_active %}
                    <span class="status" style="background: #d4edda; color: #155724;">‚úÖ –ê–∫—Ç–∏–≤–µ–Ω</span>
                    {% else %}
                    <span class="status" style="background: #f8d7da; color: #721c24;">‚ùå –ù–µ–∞–∫—Ç–∏–≤–µ–Ω</span>
                    {% endif %}
                </div>
                <div>
                    <strong>ID —Ç–æ–≤–∞—Ä–∞:</strong><br>
                    <small style="font-family: monospace; background: #f8f9fa; padding: 4px 8px; border-radius: 4px;">
                        {{ product.id }}
                    </small>
                </div>
                {% if product.sku %}
                <div>
                    <strong>–ê—Ä—Ç–∏–∫—É–ª:</strong><br>
                    <span style="font-family: monospace; background: #e3f2fd; padding: 4px 8px; border-radius: 4px;">
                        {{ product.sku }}
                    </span>
                </div>
                {% endif %}
                {% if product.slug %}
                <div>
                    <strong>URL-—Å–ª–∞–≥:</strong><br>
                    <span style="font-family: monospace; color: #6c757d;">
                        {{ product.slug }}
                    </span>
                </div>
                {% endif %}
                {% if product.category_id %}
                <div>
                    <strong>ID –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:</strong><br>
                    <span style="color: #6c757d;">{{ product.category_id }}</span>
                </div>
                {% endif %}
                {% if seller %}
                <div>
                    <strong>–ü–æ—Å—Ç–∞–≤—â–∏–∫:</strong><br>
                    {{ seller.name or seller.id }}
                </div>
                {% elif product.seller_id %}
                <div>
                    <strong>ID –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞:</strong><br>
                    <span style="color: #6c757d;">{{ product.seller_id }}</span>
                </div>
                {% endif %}
                {% if product.created_at %}
                <div>
                    <strong>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:</strong><br>
                    {{ product.created_at[:16].replace('T', ' ') }}
                </div>
                {% endif %}
                {% if product.updated_at %}
                <div>
                    <strong>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:</strong><br>
                    {{ product.updated_at[:16].replace('T', ' ') }}
                </div>
                {% endif %}
            </div>
            
            {% if composition %}
            <div style="margin-top: 1.5rem; padding: 1rem; background: #e8f5e9; border-radius: 6px;">
                <strong>üå∏ –°–æ—Å—Ç–∞–≤ –±—É–∫–µ—Ç–∞:</strong><br>
                <div style="margin-top: 0.5rem; line-height: 1.8;">
                    {% for item in composition %}
                    <div style="padding: 3px 0; font-size: 1.1rem;">
                        ‚Ä¢ {{ item.amount }} √ó {{ item.flower_name }}
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% elif product.composition %}
            <div style="margin-top: 1.5rem; padding: 1rem; background: #e8f5e9; border-radius: 6px;">
                <strong>üå∏ –°–æ—Å—Ç–∞–≤ –±—É–∫–µ—Ç–∞:</strong><br>
                <div style="margin-top: 0.5rem; line-height: 1.5; font-size: 1.1rem;">
                    {{ product.composition }}
                </div>
            </div>
            {% endif %}
            
            {% if product.description %}
            <div style="margin-top: 1.5rem; padding: 1rem; background: #f8f9fa; border-radius: 6px;">
                <strong>üìù –û–ø–∏—Å–∞–Ω–∏–µ:</strong><br>
                <div style="margin-top: 0.5rem; line-height: 1.5;">
                    {{ product.description }}
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Metadata and Technical Info -->
{% if product.metadata %}
<div class="card">
    <div class="card-header">
        <h3>üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
    </div>
    <div class="card-body">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
            {% if product.metadata.get('properties') %}
            <div>
                <strong>üìã –°–≤–æ–π—Å—Ç–≤–∞ —Ç–æ–≤–∞—Ä–∞:</strong>
                <div style="margin-top: 0.5rem; background: #f8f9fa; padding: 0.75rem; border-radius: 4px; font-family: monospace; font-size: 0.85rem; max-height: 200px; overflow-y: auto;">
                    {% for key, value in product.metadata.properties.items() %}
                    <div><strong>{{ key }}:</strong> {{ value }}</div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            
            {% if product.attributes %}
            <div>
                <strong>üè∑Ô∏è –ê—Ç—Ä–∏–±—É—Ç—ã:</strong>
                <div style="margin-top: 0.5rem; background: #e3f2fd; padding: 0.75rem; border-radius: 4px; font-family: monospace; font-size: 0.85rem; max-height: 200px; overflow-y: auto;">
                    {% for key, value in product.attributes.items() %}
                    <div><strong>{{ key }}:</strong> {{ value }}</div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            
            <div>
                <strong>‚öôÔ∏è –ü–æ–ª–Ω—ã–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ:</strong>
                <div style="margin-top: 0.5rem; background: #fff3cd; padding: 0.75rem; border-radius: 4px; font-family: monospace; font-size: 0.75rem; max-height: 300px; overflow-y: auto; white-space: pre-wrap;">{{ product.metadata | tojson(indent=2) }}</div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Action Buttons -->
<div style="margin-top: 2rem; text-align: center;">
    <a href="/crm/products/{{ product.id }}/edit" class="btn btn-primary" style="margin-right: 1rem;">
        ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä
    </a>
    <a href="/crm/products" class="btn btn-secondary">
        ‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É —Ç–æ–≤–∞—Ä–æ–≤
    </a>
</div>

{% endblock %}